
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>M1: Energies with MRChem</title>
    
  <link href="../../_static/css/theme.css" rel="stylesheet" />
  <link href="../../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx_lesson.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/tabs.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/minipres.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://3Dmol.org/build/3Dmol-min.js"></script>
    <link rel="index" title="Index" href="../../genindex/" />
    <link rel="search" title="Search" href="../../search/" />
    <link rel="next" title="M2: Properties with MRChem" href="../mrchem-laptop-2/" />
    <link rel="prev" title="V2: SCF optimization with VAMPyR" href="../vampyr-scf/" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../_static/hylleraas-logo.png" class="logo" alt="logo">
      
      
    </a>
</div><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../">
   Multiwavelet tutorial
  </a>
 </li>
</ul>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../setup/">
   Setting up your system
  </a>
 </li>
</ul>
<p class="caption" role="heading">
 <span class="caption-text">
  Exercises
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../vampyr-intro/">
   V1: VAMPyR introduction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../vampyr-scf/">
   V2: SCF optimization with VAMPyR
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   M1: Energies with MRChem
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../mrchem-laptop-2/">
   M2: Properties with MRChem
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../mrchem-hpc/">
   M3: MRChem on HPC cluster
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/notebooks/mrchem-laptop-1.ipynb.txt"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/MRChemSoft/multiwavelet-tutorial"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/MRChemSoft/multiwavelet-tutorial/issues/new?title=Issue%20on%20page%20%2Fnotebooks/mrchem-laptop-1.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        <a class="edit-button" href="https://github.com/MRChemSoft/multiwavelet-tutorial/edit/master/content/notebooks/mrchem-laptop-1.ipynb"><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Edit this page"><i class="fas fa-pencil-alt"></i>suggest edit</button></a>
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/MRChemSoft/multiwavelet-tutorial/master?urlpath=lab/tree/content/notebooks/mrchem-laptop-1.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   M1: Energies with MRChem
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#how-to-compute-energies-with-mrchem">
     How to compute energies with MRChem
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#introduction">
       Introduction
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#the-mrchem-input-file">
       The MRChem input file
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#computational-details">
       Computational details
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#instructions">
       Instructions
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#performing-the-calculations">
   Performing the calculations
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#step-0-set-some-global-variables-to-be-used-for-this-exercise">
     Step 0: Set some global variables to be used for this exercise
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#step-1-generate-input-file">
     Step 1: Generate input file
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#step-2-call-mrchem-and-run-the-job">
     Step 2: Call MRChem and run the job
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#step-3-plot-the-scf-convergence">
     Step 3: Plot the SCF convergence
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#step-4-data-analysis">
     Step 4: Data analysis
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#step-5-visualize-multiresolution-grid-for-optimized-orbital">
     Step 5: Visualize multiresolution grid for optimized orbital
    </a>
   </li>
  </ul>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="m1-energies-with-mrchem">
<h1>M1: Energies with MRChem<a class="headerlink" href="#m1-energies-with-mrchem" title="Permalink to this headline">¶</a></h1>
<div class="section" id="how-to-compute-energies-with-mrchem">
<h2>How to compute energies with MRChem<a class="headerlink" href="#how-to-compute-energies-with-mrchem" title="Permalink to this headline">¶</a></h2>
<p>Below you will find links to all all the relevant pages of the MRChem documentation. Please refer to these if you need more details on how to set up the calculations.</p>
<p><a class="reference external" href="https://mrchem.readthedocs.io/en/latest/"><img src="https://img.shields.io/badge/Documentation-Main_Page-orange.svg?logo=LOGO"></a>
<a class="reference external" href="https://mrchem.readthedocs.io/en/latest/installation.html"><img src="https://img.shields.io/badge/I_Need_Help-Installation-teal.svg?logo=LOGO"></a>
<a class="reference external" href="https://mrchem.readthedocs.io/en/latest/users/running.html"><img src="https://img.shields.io/badge/I_Need_Help-How_To_Run-green.svg?logo=LOGO"></a>
<a class="reference external" href="https://mrchem.readthedocs.io/en/latest/users/user_inp.html"><img src="https://img.shields.io/badge/I_Need_Help-Input_Quick_Guide-blue.svg?logo=LOGO"></a>
<a class="reference external" href="https://mrchem.readthedocs.io/en/latest/users/user_ref.html"><img src="https://img.shields.io/badge/I_Need_Help-Input_Reference-purple.svg?logo=LOGO"></a>
<a class="reference external" href="https://mrchem.readthedocs.io/en/latest/users/program_json.html"><img src="https://img.shields.io/badge/I_Need_Help-JSON_Output-red.svg?logo=LOGO"></a></p>
<p>If you need additional help, don’t hesitate to ask us or take a peak at these notebooks:</p>
<p><a class="reference internal" href="../convenience_scripts/"><span class="doc std std-doc"><img src="https://img.shields.io/badge/Notebook-Convenience_Scripts-blue.svg?logo=LOGO"></span></a>
<a class="reference internal" href="../how_to_run_mrchem/"><span class="doc std std-doc"><img src="https://img.shields.io/badge/Notebook-Running_MRChem-blue.svg?logo=LOGO"></span></a>
<span class="xref myst"><img src="https://img.shields.io/badge/Notebook-Solution-blue.svg?logo=LOGO"></span></p>
<div class="section" id="introduction">
<h3>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h3>
<p>In this exercise you will use the MRChem code to perform simple energy optimizations of a water molecule, using different MultiWavelet precision levels.
We provide some GTO energies that can serve as a comparison (computed with the <code class="docutils literal notranslate"><span class="pre">ORCA</span></code> code using aug-pc-1, aug-pc-2, aug-pc-3, aug-pc-4 basis sets).</p>
<p>The <code class="docutils literal notranslate"><span class="pre">MWn</span></code> notation is a shorthand for a MW precision of <span class="math notranslate nohighlight">\(1\times10^{-n}\)</span>, and is commonly used to refer to calculations of different precisions (analogous to the DZ, TZ, QZ… notation for GTO basis sets).</p>
<hr class="docutils" />
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 3D viewer for the water molecule</span>
<span class="kn">import</span> <span class="nn">py3Dmol</span>

<span class="n">view</span> <span class="o">=</span> <span class="n">py3Dmol</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
<span class="n">view</span><span class="o">.</span><span class="n">addModel</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s1">&#39;geometries/water.xyz&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
<span class="n">view</span><span class="o">.</span><span class="n">setStyle</span><span class="p">({</span><span class="s1">&#39;stick&#39;</span><span class="p">:</span> <span class="p">{}})</span>
<span class="n">view</span><span class="o">.</span><span class="n">zoomTo</span><span class="p">()</span>
<span class="n">view</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div id="3dmolviewer_16344562744330702"  style="position: relative; width: 200px; height: 200px">
        <p id="3dmolwarning_16344562744330702" style="background-color:#ffcccc;color:black">You appear to be running in JupyterLab (or JavaScript failed to load for some other reason).  You need to install the 3dmol extension: <br>
        <tt>jupyter labextension install jupyterlab_3dmol</tt></p>
        </div>
<script>

var loadScriptAsync = function(uri){
  return new Promise((resolve, reject) => {
    var tag = document.createElement('script');
    tag.src = uri;
    tag.async = true;
    tag.onload = () => {
      resolve();
    };
  var firstScriptTag = document.getElementsByTagName('script')[0];
  firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
});
};

if(typeof $3Dmolpromise === 'undefined') {
$3Dmolpromise = null;
  $3Dmolpromise = loadScriptAsync('https://3dmol.org/build/3Dmol.js');
}

var viewer_16344562744330702 = null;
var warn = document.getElementById("3dmolwarning_16344562744330702");
if(warn) {
    warn.parentNode.removeChild(warn);
}
$3Dmolpromise.then(function() {
viewer_16344562744330702 = $3Dmol.createViewer($("#3dmolviewer_16344562744330702"),{backgroundColor:"white"});
viewer_16344562744330702.zoomTo();
	viewer_16344562744330702.addModel("3\nWater_pbe\nO -7.515506 0.484824 3.657893\nH -8.283582 -0.077847 3.449409\nH -7.066811 -0.032497 4.351478");
	viewer_16344562744330702.setStyle({"stick": {}});
	viewer_16344562744330702.zoomTo();
viewer_16344562744330702.render();
});
</script></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gto</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;aug-dz&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">76.337833062097</span><span class="p">,</span>
    <span class="s1">&#39;aug-tz&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">76.384930572433</span><span class="p">,</span>
    <span class="s1">&#39;aug-qz&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">76.388407845518</span><span class="p">,</span>
    <span class="s1">&#39;aug-5z&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">76.388593505849</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="the-mrchem-input-file">
<h3>The MRChem input file<a class="headerlink" href="#the-mrchem-input-file" title="Permalink to this headline">¶</a></h3>
<p>Below is an outline of an MRChem input for a simple energy optimization at the MW3 precision level.
Try to use the documentation pages to find the relevant keywords for setting up the calculation.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>world_prec = 1.0e-3
world_unit = angstrom

Molecule {
  $coords
  ...
  $end
}

WaveFunction {
}

SCF {
}

</pre></div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="computational-details">
<h3>Computational details<a class="headerlink" href="#computational-details" title="Permalink to this headline">¶</a></h3>
<p><strong>Note</strong>: Most of these settings are default, but it is good practice to be explicit.</p>
<ul class="simple">
<li><p>The GTO results were computed with the PBE functional, and so you should also use PBE if the results are to comparable.</p></li>
<li><p>An optimized geometry of water is supplied in <code class="docutils literal notranslate"><span class="pre">./geometries/water.xyz</span></code>.</p></li>
<li><p>Use a KAIN SCF accelerator history of 5.</p></li>
<li><p>Make sure the SCF <code class="docutils literal notranslate"><span class="pre">max_iter</span></code> option is large enough (20 should be plenty).</p></li>
<li><p>As starting guess, <code class="docutils literal notranslate"><span class="pre">sad_dz</span></code> works well.</p></li>
</ul>
<blockquote>
<div><p><strong>Note</strong>
Input blocks are case sensitive, while keywords inside blocks are not</p>
</div></blockquote>
</div>
<hr class="docutils" />
<div class="section" id="instructions">
<h3>Instructions<a class="headerlink" href="#instructions" title="Permalink to this headline">¶</a></h3>
<ol class="simple">
<li><p>Generate the necessary input files necessary. You can either do this in your favorite command line text editor (vim, emacs, nano, etc), or use our supplied Python scripts from within the notebook. Some tips are given below to help you get you started if you choose the notebook route.</p></li>
<li><p>Submit the calculations as described above (terminal based) or below (notebook based).</p></li>
<li><p>You are encouraged to take a look at the output file (<code class="docutils literal notranslate"><span class="pre">jobname.out</span></code>) to look at the information printed here, and also to check out the JSON output file (<code class="docutils literal notranslate"><span class="pre">jobname.json</span></code>) to see the same output in a very scripting friendly format.</p></li>
<li><p>Extract the relevant information from either the <code class="docutils literal notranslate"><span class="pre">jobname.out</span></code> file or the <code class="docutils literal notranslate"><span class="pre">jobname.json</span></code> file, and store the results in a python variable.</p></li>
<li><p>Using the MW5 data as a reference, compute the basis set errors for the other methods. Try to visualize these either as a table or by plotting the errors.</p></li>
</ol>
</div>
</div>
</div>
<hr class="docutils" />
<div class="tex2jax_ignore mathjax_ignore section" id="performing-the-calculations">
<h1>Performing the calculations<a class="headerlink" href="#performing-the-calculations" title="Permalink to this headline">¶</a></h1>
<p>Run calculations for at the MW3, MW4, and MW5 precision levels</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="kn">from</span> <span class="nn">utils.functions</span> <span class="kn">import</span> <span class="n">MRChemOutput</span><span class="p">,</span> <span class="n">makeEnergyInput</span><span class="p">,</span> <span class="n">submit</span>
<span class="kn">from</span> <span class="nn">grid_plotter</span> <span class="kn">import</span> <span class="n">grid_plotter</span>
<span class="kn">from</span> <span class="nn">vampyr</span> <span class="kn">import</span> <span class="n">vampyr3d</span> <span class="k">as</span> <span class="n">vp</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="step-0-set-some-global-variables-to-be-used-for-this-exercise">
<h2>Step 0: Set some global variables to be used for this exercise<a class="headerlink" href="#step-0-set-some-global-variables-to-be-used-for-this-exercise" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">BASENAME</span>   <span class="o">=</span> <span class="s1">&#39;&#39;</span>             <span class="c1"># Subsequent input and output files will be named &lt;BASENAME_mwn&gt;</span>
<span class="n">NPROCS</span>     <span class="o">=</span> <span class="s1">&#39;&#39;</span>             <span class="c1"># Number of OMP threads to be used in the calculations</span>
<span class="n">PRECISIONS</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;mw3&#39;</span><span class="p">:</span> <span class="mf">1e-3</span><span class="p">,</span> 
              <span class="s1">&#39;mw4&#39;</span><span class="p">:</span> <span class="mf">1e-4</span><span class="p">,</span> 
              <span class="s1">&#39;mw5&#39;</span><span class="p">:</span> <span class="mf">1e-5</span><span class="p">}</span>  <span class="c1"># precisions and labels</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="step-1-generate-input-file">
<h2>Step 1: Generate input file<a class="headerlink" href="#step-1-generate-input-file" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">makeEnergyInput</span></code> will generate an input file in the current directory. Check out the <code class="docutils literal notranslate"><span class="pre">convenience_scripts.ipynb</span></code> Notebook for more help on how to use the function.</p>
<p>Fill in the missing data below to generate an input file in the current working directory.</p>
<p>Take a look at the generated input file before continuing.</p>
<div class="cell tag_hide_output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">prec_label</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>  <span class="c1"># mw3, mw4, or mw5</span>
<span class="n">jobname</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">BASENAME</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">prec_label</span><span class="si">}</span><span class="s1">&#39;</span>
<span class="n">xyzfile</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

<span class="n">makeEnergyInput</span><span class="p">(</span><span class="n">world_prec</span><span class="o">=</span><span class="n">PRECISIONS</span><span class="p">[</span><span class="n">prec_label</span><span class="p">],</span> <span class="n">fname</span><span class="o">=</span><span class="n">jobname</span><span class="p">,</span> <span class="n">xyzfile</span><span class="o">=</span><span class="n">xyzfile</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="step-2-call-mrchem-and-run-the-job">
<h2>Step 2: Call MRChem and run the job<a class="headerlink" href="#step-2-call-mrchem-and-run-the-job" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">submit</span></code> will generate a new directory to which it moves the previously generated input file (which must exist). It then sets up the <code class="docutils literal notranslate"><span class="pre">OMP_NUM_THREADS</span></code> environment variable, and calls MRChem.</p>
<div class="cell tag_hide_output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">submit</span><span class="p">(</span><span class="n">nprocs</span><span class="o">=</span><span class="n">NPROCS</span><span class="p">,</span> <span class="n">inputfile</span><span class="o">=</span><span class="n">jobname</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="step-3-plot-the-scf-convergence">
<h2>Step 3: Plot the SCF convergence<a class="headerlink" href="#step-3-plot-the-scf-convergence" title="Permalink to this headline">¶</a></h2>
<p>You can use our convenience class <code class="docutils literal notranslate"><span class="pre">MRChemOutput</span></code> to see how the SCFs converged.
The code assumes that your output files are named according to <code class="docutils literal notranslate"><span class="pre">&lt;jobname&gt;_&lt;mwn&gt;.json</span></code> (n=3,4,5), and that these are located in directories named according to <code class="docutils literal notranslate"><span class="pre">&lt;jobname&gt;_&lt;mwn&gt;_calc</span></code>. If you used the script providede above, then this will automatically be the case.</p>
<p>Just modify the <code class="docutils literal notranslate"><span class="pre">base</span></code> variable to be the same as what you named your input files.</p>
<p>In addition, the loop below stores the final SCF energies in a list called <code class="docutils literal notranslate"><span class="pre">mw_data</span></code> that will be used in the subsequent cell for data analysis and visualization.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mw_data</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">label</span><span class="p">,</span> <span class="n">prec</span> <span class="ow">in</span> <span class="n">PRECISIONS</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">jobname</span><span class="si">}</span><span class="s1">_calc&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">jobname</span><span class="si">}</span><span class="s1">.json&#39;</span><span class="p">)</span>
    <span class="n">calc</span> <span class="o">=</span> <span class="n">MRChemOutput</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="n">mw_data</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">label</span><span class="p">,</span> <span class="n">calc</span><span class="o">.</span><span class="n">getFinalSCFEnergy</span><span class="p">()))</span>
    <span class="n">calc</span><span class="o">.</span><span class="n">plotSCFConvergence</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="step-4-data-analysis">
<h2>Step 4: Data analysis<a class="headerlink" href="#step-4-data-analysis" title="Permalink to this headline">¶</a></h2>
<p>The code below will combine the MW and GTO data into a <code class="docutils literal notranslate"><span class="pre">pandas.DataFrame</span></code>, compute the basis set errors using your <code class="docutils literal notranslate"><span class="pre">MW5</span></code> results as a reference, and visualize the errors in a <code class="docutils literal notranslate"><span class="pre">matplotlib</span></code> bar plot.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gto_data</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;dz&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mf">76.337833062097</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;tz&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mf">76.384930572433</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;qz&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mf">76.388407845518</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;5z&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mf">76.388593505849</span><span class="p">)</span>
<span class="p">]</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">gto_data</span><span class="o">+</span><span class="n">mw_data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Basis&#39;</span><span class="p">,</span> <span class="s1">&#39;Energy&#39;</span><span class="p">])</span>
<span class="n">ref</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">Basis</span> <span class="o">==</span> <span class="s1">&#39;mw5&#39;</span><span class="p">][</span><span class="s1">&#39;Energy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;Error&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Energy&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">ref</span>
<span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">Basis</span> <span class="o">==</span> <span class="s1">&#39;mw5&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Plot</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Basis set error (a.u.)&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">Basis</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="n">df</span><span class="o">.</span><span class="n">Error</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;salmon&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="step-5-visualize-multiresolution-grid-for-optimized-orbital">
<h2>Step 5: Visualize multiresolution grid for optimized orbital<a class="headerlink" href="#step-5-visualize-multiresolution-grid-for-optimized-orbital" title="Permalink to this headline">¶</a></h2>
<p>As a last step you can use the <code class="docutils literal notranslate"><span class="pre">grid_plotter</span></code> tool to visualize the optimized multiresolution grid of one of the orbital files.
Just update the <code class="docutils literal notranslate"><span class="pre">basename</span></code> variable, and the code should find your orbital file (assuming you used the supplied Python functions for submitting your calculations).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_mra</span><span class="p">(</span><span class="n">jsonfile</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return a vp.MultiResolutionAnalysis object with </span>
<span class="sd">       parameters read from the JSON output file.&quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">jsonfile</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">j</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
    
    <span class="n">boxes</span> <span class="o">=</span> <span class="n">j</span><span class="p">[</span><span class="s1">&#39;input&#39;</span><span class="p">][</span><span class="s1">&#39;mra&#39;</span><span class="p">][</span><span class="s1">&#39;boxes&#39;</span><span class="p">]</span>
    <span class="n">corner</span> <span class="o">=</span> <span class="n">j</span><span class="p">[</span><span class="s1">&#39;input&#39;</span><span class="p">][</span><span class="s1">&#39;mra&#39;</span><span class="p">][</span><span class="s1">&#39;corner&#39;</span><span class="p">]</span>
    <span class="n">order</span> <span class="o">=</span> <span class="n">j</span><span class="p">[</span><span class="s1">&#39;input&#39;</span><span class="p">][</span><span class="s1">&#39;mra&#39;</span><span class="p">][</span><span class="s1">&#39;basis_order&#39;</span><span class="p">]</span>
    <span class="n">scale</span> <span class="o">=</span> <span class="n">j</span><span class="p">[</span><span class="s1">&#39;input&#39;</span><span class="p">][</span><span class="s1">&#39;mra&#39;</span><span class="p">][</span><span class="s1">&#39;min_scale&#39;</span><span class="p">]</span>
    
    <span class="k">return</span> <span class="n">vp</span><span class="o">.</span><span class="n">MultiResolutionAnalysis</span><span class="p">(</span><span class="n">box</span><span class="o">=</span><span class="n">vp</span><span class="o">.</span><span class="n">BoundingBox</span><span class="p">(</span><span class="n">nboxes</span><span class="o">=</span><span class="n">boxes</span><span class="p">,</span> <span class="n">corner</span><span class="o">=</span><span class="n">corner</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">),</span> <span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Use the supplied grid_plotter to visualize the grid</span>
<span class="n">calcdir</span> <span class="o">=</span> <span class="n">jobname</span> <span class="o">+</span> <span class="s1">&#39;_calc&#39;</span>
<span class="n">orb</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">calcdir</span><span class="p">,</span> <span class="s1">&#39;orbitals&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;phi_p_scf_idx_0_re&#39;</span><span class="p">)</span>

<span class="n">mra</span> <span class="o">=</span> <span class="n">get_mra</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">calcdir</span><span class="p">,</span> <span class="n">jobname</span><span class="o">+</span><span class="s1">&#39;.json&#39;</span><span class="p">))</span>
<span class="n">tree</span> <span class="o">=</span> <span class="n">vp</span><span class="o">.</span><span class="n">FunctionTree</span><span class="p">(</span><span class="n">mra</span><span class="p">)</span>
<span class="n">tree</span><span class="o">.</span><span class="n">loadTree</span><span class="p">(</span><span class="n">orb</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">grid_plotter</span><span class="p">(</span><span class="n">tree</span><span class="o">=</span><span class="n">tree</span><span class="p">)</span>

<span class="c1"># fig.savefig(f&#39;MultiResGrid_{jobname}.png&#39;)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>


              </div>
              
        
            



<div class='prev-next-bottom'>
    
    <div id="prev">
        <a class="left-prev" href="../vampyr-scf/" title="previous page">
            <i class="prevnext-label fas fa-angle-left"></i>
            <div class="prevnext-info">
                <p class="prevnext-label">previous</p>
                <p class="prevnext-title">V2: SCF optimization with VAMPyR</p>
            </div>
        </a>
    </div>
     <div id="next">
        <a class="right-next" href="../mrchem-laptop-2/" title="next page">
            <div class="prevnext-info">
                <p class="prevnext-label">next</p>
                <p class="prevnext-title">M2: Properties with MRChem</p>
            </div>
            <i class="prevnext-label fas fa-angle-right"></i>
        </a>
     </div>

</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          By The contributors<br/>
        
            &copy; Copyright 2021, The contributors.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>